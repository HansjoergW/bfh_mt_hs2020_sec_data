---

title: Complete and Combine

keywords: fastai
sidebar: home_sidebar



---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 05_CompleteAndCombine.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Basic-Settings">Basic Settings<a class="anchor-link" href="#Basic-Settings"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># imports</span>
<span class="kn">from</span> <span class="nn">bfh_mt_hs2020_sec_data.core</span> <span class="kn">import</span> <span class="o">*</span> 
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Set</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">shutil</span>          <span class="c1"># provides high level file operations</span>
<span class="kn">import</span> <span class="nn">time</span>            <span class="c1"># used to measure execution time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span><span class="p">;</span> <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_pivot_selected_folder</span>  <span class="o">=</span> <span class="s2">&quot;D:/data/parq_pivot_select&quot;</span>
<span class="n">all_pivoted_folder</span> <span class="o">=</span> <span class="s2">&quot;D:/data/parq_pivot_split&quot;</span>
<span class="n">all_processed_folder</span> <span class="o">=</span> <span class="s2">&quot;D:/data/parq_processed/&quot;</span>

<span class="n">pivot_group</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cik&quot;</span><span class="p">,</span><span class="s2">&quot;ticker&quot;</span><span class="p">,</span><span class="s2">&quot;adsh&quot;</span><span class="p">,</span><span class="s2">&quot;period&quot;</span><span class="p">,</span><span class="s2">&quot;filed&quot;</span><span class="p">,</span><span class="s2">&quot;form&quot;</span><span class="p">,</span><span class="s2">&quot;qtrs&quot;</span><span class="p">,</span><span class="s2">&quot;fp&quot;</span><span class="p">]</span>
<span class="n">analyze_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;value_count&quot;</span><span class="p">,</span><span class="s2">&quot;null_count&quot;</span><span class="p">,</span><span class="s2">&quot;difference&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="02_Tools">02_Tools<a class="anchor-link" href="#02_Tools"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">count_null</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">value_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span>  <span class="nb">set</span><span class="p">(</span><span class="n">pivot_group</span><span class="p">)</span>
    <span class="n">value_cols</span> <span class="o">=</span> <span class="n">value_cols</span> <span class="o">-</span>  <span class="nb">set</span><span class="p">(</span><span class="n">analyze_fields</span><span class="p">)</span>
    
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;value_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">value_cols</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;null_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">value_cols</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lines with missing values: &quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">null_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">stmt</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">all_processed_folder</span> <span class="o">+</span> <span class="n">stmt</span> <span class="o">+</span> <span class="s2">&quot;_not_cleaned.csv&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">filed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">filed</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">check_number_of_reports</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    check if there is only one entry per report (unique adsh)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;is there just one report per ADSH: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">adsh</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">==</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">missing_value_report</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="n">df_missing</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">null_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_missing</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;null_count&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_missing</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="01_Complete-BS">01_Complete BS<a class="anchor-link" href="#01_Complete-BS"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="load-data">load data<a class="anchor-link" href="#load-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_df</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s2">&quot;bs&quot;</span><span class="p">)</span>
<span class="n">count_null</span><span class="p">(</span><span class="n">bs_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>lines with missing values:  1301
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(116519, 18)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">check_number_of_reports</span><span class="p">(</span><span class="n">bs_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is there just one report per ADSH:  True
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="complete-missing-Equity">complete missing Equity<a class="anchor-link" href="#complete-missing-Equity"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># complete Equity_hj = Assets - Liabilities</span>
<span class="n">do_set_equity</span> <span class="o">=</span> <span class="p">(</span><span class="n">bs_df</span><span class="o">.</span><span class="n">Equity_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">Assets</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">Liabilities</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
<span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_equity</span><span class="p">,</span> <span class="s1">&#39;Equity_hj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_equity</span><span class="p">,</span> <span class="s1">&#39;Assets&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_equity</span><span class="p">,</span> <span class="s1">&#39;Liabilities&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count_null</span><span class="p">(</span><span class="n">bs_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>lines with missing values:  559
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="complete-missing-liabilities">complete missing liabilities<a class="anchor-link" href="#complete-missing-liabilities"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">do_set_liab</span> <span class="o">=</span> <span class="p">(</span><span class="n">bs_df</span><span class="o">.</span><span class="n">Assets</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">Equity_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">Liabilities</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">LiabilitiesCurrent</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">LiabilitiesNoncurrent</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
<span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;Liabilities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;Assets&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;Equity_hj&#39;</span><span class="p">]</span>
<span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesCurrent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;Liabilities&#39;</span><span class="p">]</span>
<span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesNoncurrent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count_null</span><span class="p">(</span><span class="n">bs_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>lines with missing values:  282
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="complete-missing-assets">complete missing assets<a class="anchor-link" href="#complete-missing-assets"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">do_set_liab</span> <span class="o">=</span> <span class="p">(</span><span class="n">bs_df</span><span class="o">.</span><span class="n">Liabilities</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">Equity_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">Assets</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">AssetsCurrent</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">AssetsNoncurrent</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
<span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;Assets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;Liabilities&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;Equity_hj&#39;</span><span class="p">]</span>
<span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;AssetsCurrent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;Liabilities&#39;</span><span class="p">]</span>
<span class="n">bs_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_liab</span><span class="p">,</span> <span class="s1">&#39;AssetsNoncurrent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count_null</span><span class="p">(</span><span class="n">bs_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>lines with missing values:  274
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="remove-companies-with-incomplete-balancesheets">remove companies with incomplete balancesheets<a class="anchor-link" href="#remove-companies-with-incomplete-balancesheets"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">incomplete_ciks</span> <span class="o">=</span> <span class="n">bs_df</span><span class="p">[</span><span class="n">bs_df</span><span class="o">.</span><span class="n">null_count</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">cik</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">incomplete_ciks</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>82
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_cleaned</span> <span class="o">=</span> <span class="n">bs_df</span><span class="p">[</span><span class="o">~</span><span class="n">bs_df</span><span class="o">.</span><span class="n">cik</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">incomplete_ciks</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_cleaned</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(114481, 18)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="save">save<a class="anchor-link" href="#save"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_cleaned</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">analyze_fields</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">all_processed_folder</span> <span class="o">+</span> <span class="s2">&quot;bs_clean.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="02_Complete-CF">02_Complete CF<a class="anchor-link" href="#02_Complete-CF"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="load-data">load data<a class="anchor-link" href="#load-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cf_df</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s2">&quot;cf&quot;</span><span class="p">)</span>
<span class="n">count_null</span><span class="p">(</span><span class="n">cf_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>lines with missing values:  1359
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cf_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(116187, 18)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">check_number_of_reports</span><span class="p">(</span><span class="n">cf_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is there just one report per ADSH:  True
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="complete-CashIncreaseDecrease">complete CashIncreaseDecrease<a class="anchor-link" href="#complete-CashIncreaseDecrease"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># per definition CashIncreaseDecrease = NetCashProvidedByUsedInOperatingActivities + NetCashProvidedByUsedInInvestingActivities + NetCashProvidedByUsedInFinancingActivities</span>
<span class="n">do_set_cshinc</span> <span class="o">=</span> <span class="p">(</span><span class="n">cf_df</span><span class="o">.</span><span class="n">CashIncreaseDecrease_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">cf_df</span><span class="o">.</span><span class="n">NetCashProvidedByUsedInOperatingActivities</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> 
                 <span class="n">cf_df</span><span class="o">.</span><span class="n">NetCashProvidedByUsedInInvestingActivities</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">cf_df</span><span class="o">.</span><span class="n">NetCashProvidedByUsedInFinancingActivities</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
<span class="n">cf_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_cshinc</span><span class="p">,</span> <span class="s1">&#39;CashIncreaseDecrease_hj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cf_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_cshinc</span><span class="p">,</span> <span class="s1">&#39;NetCashProvidedByUsedInOperatingActivities&#39;</span><span class="p">]</span> \
                                                    <span class="o">+</span> <span class="n">cf_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_cshinc</span><span class="p">,</span> <span class="s1">&#39;NetCashProvidedByUsedInInvestingActivities&#39;</span><span class="p">]</span> \
                                                    <span class="o">+</span> <span class="n">cf_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_cshinc</span><span class="p">,</span> <span class="s1">&#39;NetCashProvidedByUsedInFinancingActivities&#39;</span><span class="p">]</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count_null</span><span class="p">(</span><span class="n">cf_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>lines with missing values:  377
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="complete-NetCashProvidedByUsedInOperatingActivities">complete NetCashProvidedByUsedInOperatingActivities<a class="anchor-link" href="#complete-NetCashProvidedByUsedInOperatingActivities"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># per definition CashIncreaseDecrease = NetCashProvidedByUsedInOperatingActivities + NetCashProvidedByUsedInInvestingActivities + NetCashProvidedByUsedInFinancingActivities</span>
<span class="c1"># hence NetCashProvidedByUsedInOperatingActivities = CashIncreaseDecrease - (NetCashProvidedByUsedInInvestingActivities + NetCashProvidedByUsedInFinancingActivities)</span>
<span class="n">do_set_netop</span> <span class="o">=</span> <span class="p">(</span><span class="n">cf_df</span><span class="o">.</span><span class="n">CashIncreaseDecrease_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">cf_df</span><span class="o">.</span><span class="n">NetCashProvidedByUsedInOperatingActivities</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="o">&amp;</span> 
                 <span class="n">cf_df</span><span class="o">.</span><span class="n">NetCashProvidedByUsedInInvestingActivities</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">cf_df</span><span class="o">.</span><span class="n">NetCashProvidedByUsedInFinancingActivities</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
<span class="n">cf_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_netop</span><span class="p">,</span> <span class="s1">&#39;NetCashProvidedByUsedInOperatingActivities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cf_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_netop</span><span class="p">,</span> <span class="s1">&#39;CashIncreaseDecrease_hj&#39;</span><span class="p">]</span> \
                                                                      <span class="o">-</span> <span class="p">(</span><span class="n">cf_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_netop</span><span class="p">,</span> <span class="s1">&#39;NetCashProvidedByUsedInInvestingActivities&#39;</span><span class="p">]</span>  <span class="o">+</span> <span class="n">cf_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_netop</span><span class="p">,</span> <span class="s1">&#39;NetCashProvidedByUsedInFinancingActivities&#39;</span><span class="p">]</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count_null</span><span class="p">(</span><span class="n">cf_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>lines with missing values:  316
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="remove-companies-with-incomplete-cash-flow-statment">remove companies with incomplete cash flow statment<a class="anchor-link" href="#remove-companies-with-incomplete-cash-flow-statment"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">incomplete_ciks</span> <span class="o">=</span> <span class="n">cf_df</span><span class="p">[</span><span class="n">cf_df</span><span class="o">.</span><span class="n">null_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cik</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">incomplete_ciks</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>146
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cf_cleaned</span> <span class="o">=</span> <span class="n">cf_df</span><span class="p">[</span><span class="o">~</span><span class="n">cf_df</span><span class="o">.</span><span class="n">cik</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">incomplete_ciks</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cf_cleaned</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(112417, 18)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="save">save<a class="anchor-link" href="#save"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cf_cleaned</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">analyze_fields</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">all_processed_folder</span> <span class="o">+</span> <span class="s2">&quot;cf_clean.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="03_Complete-IS">03_Complete IS<a class="anchor-link" href="#03_Complete-IS"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="load-data">load data<a class="anchor-link" href="#load-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_df</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s2">&quot;is&quot;</span><span class="p">)</span>
<span class="n">count_null</span><span class="p">(</span><span class="n">is_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>lines with missing values:  115883
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(115899, 21)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">check_number_of_reports</span><span class="p">(</span><span class="n">is_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>is there just one report per ADSH:  True
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="complete-GrossProfit">complete GrossProfit<a class="anchor-link" href="#complete-GrossProfit"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># per definition Grossprofit = Revenues - CostOfRevenue</span>
<span class="n">do_set_grossp</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">CostOfRevenue_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
<span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_grossp</span><span class="p">,</span> <span class="s1">&#39;GrossProfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_grossp</span><span class="p">,</span> <span class="s1">&#39;Revenues_hj&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_grossp</span><span class="p">,</span> <span class="s1">&#39;CostOfRevenue_hj&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># per definition: grossprofit - opexpenses = op-income -&gt; grossprofit = opincome + opexpenses</span>
<span class="n">do_set_grossp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">OperatingExpenses</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
<span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_grossp1</span><span class="p">,</span> <span class="s1">&#39;GrossProfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_grossp1</span><span class="p">,</span> <span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_grossp1</span><span class="p">,</span> <span class="s1">&#39;OperatingExpenses&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="complete-Revenues">complete Revenues<a class="anchor-link" href="#complete-Revenues"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># per definition Grossprofit = Revenues - CostOfRevenue -&gt; Revenues = Grossprofit + CostOfRevenue</span>
<span class="n">do_set_rev</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">CostOfRevenue_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
<span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_rev</span><span class="p">,</span> <span class="s1">&#39;Revenues_hj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_rev</span><span class="p">,</span> <span class="s1">&#39;CostOfRevenue_hj&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_rev</span><span class="p">,</span> <span class="s1">&#39;GrossProfit&#39;</span><span class="p">]</span>
<span class="n">set_to_zero_if_null</span><span class="p">(</span><span class="n">is_df</span><span class="p">,</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="complete-CostOfRevenue">complete CostOfRevenue<a class="anchor-link" href="#complete-CostOfRevenue"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># per definition Grossprofit = Revenues - CostOfRevenue -&gt; CostOfRevenue = Revenues - Grossprofit</span>
<span class="n">do_set_cstrev</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">CostOfRevenue_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
<span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_cstrev</span><span class="p">,</span> <span class="s1">&#39;CostOfRevenue_hj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_cstrev</span><span class="p">,</span> <span class="s1">&#39;Revenues_hj&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_cstrev</span><span class="p">,</span> <span class="s1">&#39;GrossProfit&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="complete-OperatingIncomeLoss">complete OperatingIncomeLoss<a class="anchor-link" href="#complete-OperatingIncomeLoss"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># per definition: opIncomeLoss = grossprofit - opexpenses</span>
<span class="n">do_set_opinc</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">OperatingExpenses</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
<span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_opinc</span><span class="p">,</span> <span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_opinc</span><span class="p">,</span> <span class="s1">&#39;GrossProfit&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_set_opinc</span><span class="p">,</span> <span class="s1">&#39;OperatingExpenses&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>4073</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="estimate-OperatingIncomeLoss_hj-based-on-GrossProfit-and-NetIncomeLoss">estimate OperatingIncomeLoss_hj based on GrossProfit and NetIncomeLoss<a class="anchor-link" href="#estimate-OperatingIncomeLoss_hj-based-on-GrossProfit-and-NetIncomeLoss"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># if OperatingIncomeLoss is not set, we can try to estimate it based on the average compared to GrossProfit and NetIncomeLoss</span>

<span class="c1"># based on existing OperatingIncomeLoss_hj Values, we calculate the average OperatingIncomeLoss_hj between GrossProfit and NetIncomeLoss (in percent)</span>
<span class="c1">#  we may only consider entries where NetIncomeLoss isn&#39;t equal to GrossProfit. since this would cause a division by zero</span>
<span class="n">calc_mean_opinc_avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span> <span class="o">!=</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="p">))</span>
<span class="n">selected_cols</span> <span class="o">=</span> <span class="n">is_df</span><span class="p">[</span><span class="n">calc_mean_opinc_avg</span><span class="p">][[</span><span class="s1">&#39;NetIncomeLoss_hj&#39;</span><span class="p">,</span><span class="s1">&#39;GrossProfit&#39;</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">avg_opinc</span> <span class="o">=</span> <span class="p">((</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">-</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">-</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># if we have grossprofit and NetIncomeLoss_hj, we try estimate OperatingIncomeLoss based on the average position</span>
<span class="n">do_updated_opinc</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>

<span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_opinc</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_opinc</span><span class="p">,</span><span class="s1">&#39;GrossProfit&#39;</span><span class="p">]</span> \
                                    <span class="o">-</span> <span class="n">avg_opinc</span> <span class="o">*</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_opinc</span><span class="p">,</span><span class="s1">&#39;GrossProfit&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_opinc</span><span class="p">,</span><span class="s1">&#39;NetIncomeLoss_hj&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>47</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="estimate-OperatingIncomeLoss_hj-based-on-Revenues-and-NetIncomeLoss">estimate OperatingIncomeLoss_hj based on Revenues and NetIncomeLoss<a class="anchor-link" href="#estimate-OperatingIncomeLoss_hj-based-on-Revenues-and-NetIncomeLoss"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># if OperatingIncomeLoss is not set, we can try to estimate it based on the average compared to Revenues and NetIncomeLoss</span>

<span class="c1"># based on existing OperatingIncomeLoss_hj Values, we calculate the average OperatingIncomeLoss_hj between Revenue and NetIncomeLoss (in percent)</span>
<span class="n">calc_mean_opinc_avg</span> <span class="o">=</span> <span class="p">((</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()))</span>
<span class="n">selected_cols</span> <span class="o">=</span> <span class="n">is_df</span><span class="p">[</span><span class="n">calc_mean_opinc_avg</span><span class="p">][[</span><span class="s1">&#39;NetIncomeLoss_hj&#39;</span><span class="p">,</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">avg_opinc</span> <span class="o">=</span> <span class="p">((</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">-</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">-</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># if we have revenue and NetIncomeLoss_hj, we try estimate OperatingIncomeLoss based on the average position</span>
<span class="n">do_updated_opinc</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>

<span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_opinc</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_opinc</span><span class="p">,</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">]</span> \
                                    <span class="o">-</span> <span class="n">avg_opinc</span> <span class="o">*</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_opinc</span><span class="p">,</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_opinc</span><span class="p">,</span><span class="s1">&#39;NetIncomeLoss_hj&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>47</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="estimate-GrossProfit-based-on-Revenue-and-OperatingIncomeLoss">estimate GrossProfit based on Revenue and OperatingIncomeLoss<a class="anchor-link" href="#estimate-GrossProfit-based-on-Revenue-and-OperatingIncomeLoss"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># if Grossprofit is not set, we can try to estimate it based on the average compared to reveneue and operatingIncomeLoss</span>

<span class="c1"># based on existing GrossProfit Values, we calculate the average grossprofit between Revenue and OperatingIncome (in percent)</span>
<span class="n">calc_mean_gp_selection</span> <span class="o">=</span> <span class="p">((</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>  <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()))</span>
<span class="n">selected_cols</span> <span class="o">=</span> <span class="n">is_df</span><span class="p">[</span><span class="n">calc_mean_gp_selection</span><span class="p">][[</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">,</span><span class="s1">&#39;GrossProfit&#39;</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">avg_gross</span> <span class="o">=</span> <span class="p">((</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">-</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">GrossProfit</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">-</span><span class="n">selected_cols</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># if we have revenue and operatingincome, we try estimate grossprofit based on the average position</span>
<span class="n">do_updated_grossprofit</span> <span class="o">=</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>

<span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_grossprofit</span><span class="p">,</span><span class="s1">&#39;GrossProfit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_grossprofit</span><span class="p">,</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">]</span> \
                                    <span class="o">-</span> <span class="n">avg_gross</span> <span class="o">*</span> <span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_grossprofit</span><span class="p">,</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">is_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">do_updated_grossprofit</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">is_df</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>621</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="remove-companies-with-incomplete-income-statment">remove companies with incomplete income statment<a class="anchor-link" href="#remove-companies-with-incomplete-income-statment"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">incomplete_ciks</span> <span class="o">=</span> <span class="n">is_df</span><span class="p">[(</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">is_df</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">())]</span><span class="o">.</span><span class="n">cik</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">incomplete_ciks</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>160
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_cleaned</span> <span class="o">=</span> <span class="n">is_df</span><span class="p">[</span><span class="o">~</span><span class="n">is_df</span><span class="o">.</span><span class="n">cik</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">incomplete_ciks</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_cleaned</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(111495, 21)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="save">save<a class="anchor-link" href="#save"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pivot_group</span><span class="p">)</span>
<span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">,</span><span class="s1">&#39;GrossProfit&#39;</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">,</span><span class="s1">&#39;NetIncomeLoss_hj&#39;</span><span class="p">,</span> <span class="s1">&#39;SharesOutstanding_hj&#39;</span><span class="p">,</span><span class="s1">&#39;EarningsPerShare_hj&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_cleaned</span><span class="p">[</span><span class="n">fields</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">all_processed_folder</span> <span class="o">+</span> <span class="s2">&quot;is_clean.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="XX_Trials">XX_Trials<a class="anchor-link" href="#XX_Trials"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_df</span><span class="p">[((</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="p">))]</span> \
  <span class="p">[[</span><span class="s1">&#39;cik&#39;</span><span class="p">,</span><span class="s1">&#39;adsh&#39;</span><span class="p">,</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">,</span><span class="s1">&#39;GrossProfit&#39;</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">,</span> <span class="s1">&#39;NetIncomeLoss_hj&#39;</span><span class="p">,</span> <span class="s1">&#39;OperatingExpenses&#39;</span><span class="p">,</span><span class="s1">&#39;CostsAndExpenses&#39;</span><span class="p">]]</span> <span class="c1">#721</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_df</span><span class="p">[((</span><span class="n">is_df</span><span class="o">.</span><span class="n">Revenues_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">|</span> <span class="n">is_df</span><span class="o">.</span><span class="n">NetIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="p">))]</span> \
  <span class="p">[[</span><span class="s1">&#39;cik&#39;</span><span class="p">,</span><span class="s1">&#39;adsh&#39;</span><span class="p">,</span><span class="s1">&#39;Revenues_hj&#39;</span><span class="p">,</span><span class="s1">&#39;GrossProfit&#39;</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">,</span> <span class="s1">&#39;NetIncomeLoss_hj&#39;</span><span class="p">,</span> <span class="s1">&#39;OperatingExpenses&#39;</span><span class="p">,</span><span class="s1">&#39;CostsAndExpenses&#39;</span><span class="p">]]</span> <span class="c1">#721</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_df</span><span class="p">[((</span><span class="n">is_df</span><span class="o">.</span><span class="n">CostsAndExpenses</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">GrossProfit</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">is_df</span><span class="o">.</span><span class="n">OperatingIncomeLoss_hj</span><span class="o">.</span><span class="n">isnull</span><span class="p">()))][[</span><span class="s1">&#39;cik&#39;</span><span class="p">,</span><span class="s1">&#39;adsh&#39;</span><span class="p">,</span><span class="s1">&#39;CostsAndExpenses&#39;</span><span class="p">,</span> <span class="s1">&#39;OperatingExpenses&#39;</span><span class="p">,</span><span class="s1">&#39;GrossProfit&#39;</span><span class="p">,</span><span class="s1">&#39;OperatingIncomeLoss_hj&#39;</span><span class="p">]]</span> <span class="c1">#721</span>
<span class="c1">#is_df[((is_df.OperatingExpenses.notnull() &amp; is_df.GrossProfit.isnull() &amp; is_df.OperatingIncomeLoss_hj.notnull()))][[&#39;cik&#39;,&#39;adsh&#39;,&#39;OperatingExpenses&#39;,&#39;GrossProfit&#39;,&#39;OperatingIncomeLoss_hj&#39;]] #11618</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_df</span><span class="o">.</span><span class="n">adsh</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">missing_value_report</span><span class="p">(</span><span class="n">cf_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">bs_df</span><span class="o">.</span><span class="n">adsh</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">==</span> <span class="n">bs_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cf_df</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">sum</span><span class="p">(</span><span class="n">bs_df</span><span class="o">.</span><span class="n">qtrs</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1349</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>IS
Was kann man alles berechnen, wenn vorhanden
GrossProfit = Revenues - costofsales
OperatingIncome = (GrossProfit) - CostsAndExpenses
OperatingIncome = Revenues - CostsAndExpenses</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">cf_df</span><span class="p">[(</span><span class="n">cf_df</span><span class="o">.</span><span class="n">null_count</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

