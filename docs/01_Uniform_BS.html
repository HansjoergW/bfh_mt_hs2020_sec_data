---

title: uniform BS

keywords: fastai
sidebar: home_sidebar



---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 04_01_Uniform_BS.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Basic-Settings">Basic Settings<a class="anchor-link" href="#Basic-Settings"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># imports</span>
<span class="kn">from</span> <span class="nn">bfh_mt_hs2020_sec_data.core</span> <span class="kn">import</span> <span class="o">*</span> 
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Set</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.dataframe</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">shutil</span>          <span class="c1"># provides high level file operations</span>
<span class="kn">import</span> <span class="nn">time</span>            <span class="c1"># used to measure execution time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_pivot_selected_folder</span>  <span class="o">=</span> <span class="s2">&quot;D:/data/parq_pivot_select&quot;</span>
<span class="n">all_pivoted_folder</span> <span class="o">=</span> <span class="s2">&quot;D:/data/parq_pivot_split&quot;</span>
<span class="n">all_processed_folder</span> <span class="o">=</span> <span class="s2">&quot;D:/data/parq_processed/&quot;</span>

<span class="n">col_list</span> <span class="o">=</span>    <span class="p">[</span><span class="s2">&quot;stmt&quot;</span><span class="p">,</span><span class="s2">&quot;cik&quot;</span><span class="p">,</span><span class="s2">&quot;ticker&quot;</span><span class="p">,</span> <span class="s2">&quot;adsh&quot;</span><span class="p">,</span><span class="s2">&quot;period&quot;</span><span class="p">,</span><span class="s2">&quot;filed&quot;</span><span class="p">,</span> <span class="s2">&quot;form&quot;</span><span class="p">,</span><span class="s2">&quot;tag&quot;</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="s2">&quot;report&quot;</span><span class="p">,</span> <span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;fp&quot;</span><span class="p">,</span> <span class="s2">&quot;uom&quot;</span><span class="p">]</span>
<span class="n">pivot_group</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cik&quot;</span><span class="p">,</span><span class="s2">&quot;ticker&quot;</span><span class="p">,</span><span class="s2">&quot;adsh&quot;</span><span class="p">,</span><span class="s2">&quot;form&quot;</span><span class="p">,</span><span class="s2">&quot;period&quot;</span><span class="p">,</span><span class="s2">&quot;filed&quot;</span><span class="p">,</span><span class="s2">&quot;fp&quot;</span><span class="p">,</span> <span class="s2">&quot;qtrs&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># init Spark</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">get_spark_session</span><span class="p">()</span> <span class="c1"># Session anlegen</span>
<span class="n">spark</span> <span class="c1"># display the moste important information of the session</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

            <div>
                <p><b>SparkSession - in-memory</b></p>
                
        <div>
            <p><b>SparkContext</b></p>

            <p><a href="http://192.168.0.163:4041">Spark UI</a></p>

            <dl>
              <dt>Version</dt>
                <dd><code>v2.4.5</code></dd>
              <dt>Master</dt>
                <dd><code>local[*]</code></dd>
              <dt>AppName</dt>
                <dd><code>default</code></dd>
            </dl>
        </div>
        
            </div>
        
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="00_Raw_data">00_Raw_data<a class="anchor-link" href="#00_Raw_data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># loading the complete unpivoted dataset - if it is needed for debbuging</span>
<span class="n">df_all_selected</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">all_pivot_selected_folder</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># it happens sometimes, that the data could not be associated with a right sheet (bs, is, cf, ..). in this cases, the data can appea under &quot;UN&quot;</span>
<span class="c1"># so if expected information cannot be found in the appropriate statement, we have to look in the un statement</span>
<span class="n">un_pivot_value</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">all_pivoted_folder</span><span class="p">,</span> <span class="n">spark</span><span class="p">,</span> <span class="s2">&quot;UN&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="n">un_pivot_pd</span> <span class="o">=</span> <span class="n">un_pivot_value</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">un_pivot_pd</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(5989, 1775)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">prepare_un_values</span><span class="p">(</span><span class="n">df_to_merge_into</span><span class="p">,</span> <span class="n">attr_list</span><span class="p">):</span>
    <span class="c1"># add possible columns from un set to  cf data with prefix cpy_</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">pivot_group</span><span class="p">[:]</span> <span class="c1"># create copy</span>
    <span class="n">attributes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">attr_list</span><span class="p">)</span>

    <span class="n">un_prepared</span> <span class="o">=</span> <span class="n">un_pivot_pd</span><span class="p">[</span><span class="n">attributes</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">un_prepared</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>  <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pivot_group</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;cpy_&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_to_merge_into</span><span class="p">,</span> <span class="n">un_prepared</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">pivot_group</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="01_Balance_Sheet">01_Balance_Sheet<a class="anchor-link" href="#01_Balance_Sheet"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_pivot_value</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">all_pivoted_folder</span><span class="p">,</span> <span class="n">spark</span><span class="p">,</span> <span class="s2">&quot;BS&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="n">spark_shape</span><span class="p">(</span><span class="n">bs_pivot_value</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(116519, 2069)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_pivot_pd</span> <span class="o">=</span> <span class="n">bs_pivot_value</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_pivot_pd_copy</span> <span class="o">=</span> <span class="n">bs_pivot_pd</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Merge-Data-from-&quot;unknown&quot;-statement">Merge Data from "unknown" statement<a class="anchor-link" href="#Merge-Data-from-&quot;unknown&quot;-statement"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># merge relevant columns from the UN dataset</span>
<span class="n">bs_pivot_pd_copy</span> <span class="o">=</span> <span class="n">prepare_un_values</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;AssetsNet&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Assets&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AssetsNoncurrent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AssetsCurrent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Liabilities&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LiabilitiesNoncurrent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LiabilitiesCurrent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;StockholdersEquity&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LiabilitiesAndStockholdersEquity&#39;</span><span class="p">,</span>
    <span class="s1">&#39;RetainedEarningsAccumulatedDeficit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PartnersCapital&#39;</span><span class="p">,</span>
    <span class="s1">&#39;StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest&#39;</span><span class="p">,</span>
<span class="p">])</span>
<span class="n">bs_pivot_pd_copy</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(116519, 2081)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Assets">Assets<a class="anchor-link" href="#Assets"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_null_count</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Assets&#39;</span><span class="p">,</span><span class="s1">&#39;AssetsNoncurrent&#39;</span><span class="p">,</span><span class="s1">&#39;AssetsCurrent&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Assets   452
AssetsNoncurrent   110595
AssetsCurrent   26704
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># if present, copy data from UN dataset</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_AssetsNet&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetsNet&#39;</span><span class="p">)</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_Assets&#39;</span><span class="p">,</span> <span class="s1">&#39;Assets&#39;</span><span class="p">)</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_AssetsNoncurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetsNoncurrent&#39;</span><span class="p">)</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_AssetsCurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetsCurrent&#39;</span><span class="p">)</span>


<span class="c1"># Sometimes AssetsNet is present instead of Assets, copy its content to Assets</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;AssetsNet&#39;</span><span class="p">,</span> <span class="s1">&#39;Assets&#39;</span><span class="p">)</span>

<span class="c1"># if one of the three provided columns is missing, calculate its content based on Assets = AssetsCurrent + AssetsNoncurrent</span>
<span class="n">complete_addition</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;Assets&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetsCurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetsNoncurrent&#39;</span><span class="p">)</span>

<span class="c1"># if Assets contains data but AssetsCurrent and AssetsNoncurrent are empty, assume that only AssetsCurrent is present</span>
<span class="c1"># copy value from Assets to AssetsCurrent and set AssetsNoncurrent to 0.0</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;Assets&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetsCurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetsNoncurrent&#39;</span><span class="p">)</span>

<span class="c1"># if AssetsCurrent contains data and Assets  and AssetsNoncurrent are empty, assume that only AssetsCurrent is present</span>
<span class="c1"># copy value from AssetsCurrent to Assets and set AssetsNoncurrent to 0.0</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;AssetsCurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;Assets&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetsNoncurrent&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># check for how many entries Assets, AssetsNoncurrent and AsstesCurrent couldn&#39;t be completed</span>
<span class="n">print_null_count</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Assets&#39;</span><span class="p">,</span><span class="s1">&#39;AssetsNoncurrent&#39;</span><span class="p">,</span><span class="s1">&#39;AssetsCurrent&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Assets   243
AssetsNoncurrent   243
AssetsCurrent   243
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Liabilities">Liabilities<a class="anchor-link" href="#Liabilities"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_null_count</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Liabilities&#39;</span><span class="p">,</span><span class="s1">&#39;LiabilitiesNoncurrent&#39;</span><span class="p">,</span><span class="s1">&#39;LiabilitiesCurrent&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Liabilities   28633
LiabilitiesNoncurrent   102470
LiabilitiesCurrent   27067
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># if present, copy data from UN dataset</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_Liabilities&#39;</span><span class="p">,</span> <span class="s1">&#39;Liabilities&#39;</span><span class="p">)</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_LiabilitiesNoncurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesNoncurrent&#39;</span><span class="p">)</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_LiabilitiesCurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesCurrent&#39;</span><span class="p">)</span>

<span class="n">complete_addition</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;Liabilities&#39;</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesCurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesNoncurrent&#39;</span><span class="p">)</span>

<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;Liabilities&#39;</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesCurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesNoncurrent&#39;</span><span class="p">)</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesCurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;Liabilities&#39;</span><span class="p">,</span> <span class="s1">&#39;LiabilitiesNoncurrent&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># check for how many entries we were not able to complete the Liabilities information</span>
<span class="n">print_null_count</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Liabilities&#39;</span><span class="p">,</span><span class="s1">&#39;LiabilitiesNoncurrent&#39;</span><span class="p">,</span><span class="s1">&#39;LiabilitiesCurrent&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Liabilities   551
LiabilitiesNoncurrent   550
LiabilitiesCurrent   551
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Equity">Equity<a class="anchor-link" href="#Equity"> </a></h3><p>In the Equity section of the balance sheet, we are intereste in the StockholdersEquity and the Earnings (Tag. RetainedEarningsAccumulatedDeficit)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_null_count</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;StockholdersEquity&#39;</span><span class="p">,</span><span class="s1">&#39;RetainedEarningsAccumulatedDeficit&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>StockholdersEquity   10549
RetainedEarningsAccumulatedDeficit   9047
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_pivot_pd_copy</span><span class="p">[</span><span class="s1">&#39;Equity_hj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_PartnersCapital&#39;</span><span class="p">,</span> <span class="s1">&#39;PartnersCapital&#39;</span><span class="p">)</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_StockholdersEquity&#39;</span><span class="p">,</span> <span class="s1">&#39;StockholdersEquity&#39;</span><span class="p">)</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest&#39;</span><span class="p">,</span> <span class="s1">&#39;StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest&#39;</span><span class="p">)</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;cpy_RetainedEarningsAccumulatedDeficit&#39;</span><span class="p">,</span> <span class="s1">&#39;RetainedEarningsAccumulatedDeficit&#39;</span><span class="p">)</span>

<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;StockholdersEquity&#39;</span><span class="p">,</span> <span class="s1">&#39;Equity_hj&#39;</span><span class="p">)</span> 

<span class="c1"># if there is partner capital but no StockholdersEquite, we consider it the same as stockholder equity</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;PartnersCapital&#39;</span><span class="p">,</span> <span class="s1">&#39;Equity_hj&#39;</span><span class="p">)</span> 

<span class="c1"># if there is StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest instead of StockholdersEquity, we use this as StocholdersEquity</span>
<span class="n">copy_if_not_empty</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest&#39;</span><span class="p">,</span> <span class="s1">&#39;Equity_hj&#39;</span><span class="p">)</span> 

<span class="c1"># if RetainedEarnings has no value, we set it to zero</span>
<span class="n">set_to_zero_if_null</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="s1">&#39;RetainedEarningsAccumulatedDeficit&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_null_count</span><span class="p">(</span><span class="n">bs_pivot_pd_copy</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Equity_hj&#39;</span><span class="p">,</span><span class="s1">&#39;RetainedEarningsAccumulatedDeficit&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Equity_hj   987
RetainedEarningsAccumulatedDeficit   0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save">Save<a class="anchor-link" href="#Save"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs_pivot_pd_copy</span><span class="p">[[</span><span class="s2">&quot;cik&quot;</span><span class="p">,</span><span class="s2">&quot;ticker&quot;</span><span class="p">,</span> <span class="s2">&quot;adsh&quot;</span><span class="p">,</span><span class="s2">&quot;period&quot;</span><span class="p">,</span><span class="s2">&quot;filed&quot;</span><span class="p">,</span><span class="s2">&quot;form&quot;</span><span class="p">,</span> <span class="s2">&quot;qtrs&quot;</span><span class="p">,</span><span class="s2">&quot;fp&quot;</span><span class="p">,</span>
                 <span class="s1">&#39;Assets&#39;</span><span class="p">,</span><span class="s1">&#39;AssetsNoncurrent&#39;</span><span class="p">,</span> <span class="s1">&#39;AssetsCurrent&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;Liabilities&#39;</span><span class="p">,</span><span class="s1">&#39;LiabilitiesNoncurrent&#39;</span><span class="p">,</span><span class="s1">&#39;LiabilitiesCurrent&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;Equity_hj&#39;</span><span class="p">,</span><span class="s1">&#39;RetainedEarningsAccumulatedDeficit&#39;</span><span class="p">]]</span> \
        <span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">all_processed_folder</span> <span class="o">+</span> <span class="s2">&quot;bs_not_cleaned.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spark</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

