---

title: Stock

keywords: fastai
sidebar: home_sidebar



---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 08_Download_StockData.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># imports</span>
<span class="kn">from</span> <span class="nn">bfh_mt_hs2020_sec_data.core</span> <span class="kn">import</span> <span class="o">*</span> 
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Set</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">shutil</span>          <span class="c1"># provides high level file operations</span>
<span class="kn">import</span> <span class="nn">time</span>            <span class="c1"># used to measure execution time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span><span class="p">;</span> <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">yahoo_historical</span> <span class="kn">import</span> <span class="n">Fetcher</span>
<span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_data_local_folder</span> <span class="o">=</span> <span class="s2">&quot;./data/&quot;</span>
<span class="n">stock_data_folder</span> <span class="o">=</span> <span class="s2">&quot;D:/data/stocks/sec/&quot;</span>

<span class="n">join_group</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cik&quot;</span><span class="p">,</span><span class="s2">&quot;ticker&quot;</span><span class="p">,</span><span class="s2">&quot;adsh&quot;</span><span class="p">,</span><span class="s2">&quot;period&quot;</span><span class="p">,</span><span class="s2">&quot;filed&quot;</span><span class="p">,</span><span class="s2">&quot;form&quot;</span><span class="p">,</span><span class="s2">&quot;fp&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="00_Tools">00_Tools<a class="anchor-link" href="#00_Tools"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">load_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">all_data_local_folder</span> <span class="o">+</span> <span class="s2">&quot;complete.csv&quot;</span><span class="p">)</span>

    <span class="n">df</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">filed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">filed</span><span class="p">)</span>
    
    <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">load_cik_ticker</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">all_data_local_folder</span> <span class="o">+</span> <span class="s2">&quot;cik_ticker.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="01_Load-required-ticker-symbols">01_Load required ticker symbols<a class="anchor-link" href="#01_Load-required-ticker-symbols"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tickers</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">()</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tickers</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="02_Prepare-directory-structure">02_Prepare directory structure<a class="anchor-link" href="#02_Prepare-directory-structure"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ensure_dir</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates an empty directory if it doesn&#39;t exist</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">string</span>

<span class="k">def</span> <span class="nf">create_dir_structure</span><span class="p">(</span><span class="n">folder</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates the folder and creates also sub-folders ranging from &#39;A&#39; to &#39;Z&#39; beneath it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ensure_dir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span><span class="p">:</span>
        <span class="n">ensure_dir</span><span class="p">(</span><span class="n">stock_data_folder</span> <span class="o">+</span> <span class="n">char</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_dir_structure</span><span class="p">(</span><span class="n">stock_data_folder</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="03_Download-historical-data">03_Download historical data<a class="anchor-link" href="#03_Download-historical-data"> </a></h2><p>Unfortuantely, it is not that easy to get historical data of of companies that are no longer listed or went out of business for what reason ever. So we will only be able to work with companies, which are still in business. That is a problem, since a serious "survivor" bias is introduced in the data. It would be important to also have data of "failed" companies.</p>
<p>We will be using two different libraries to download: yahoo-historical and yfinance. yfinance has the advantage that Open, High, Low and Close can be download "adjusted" meaning that splits and payed dividends are taken into consideration. The standard Open, High, Low and Close from yahoo is only adjusted for splits.</p>
<p>The code in a Jupyter Notebook cannot be parallelized that easily, therefore there is the "08_Download_StodkData.py" Script that implements a parallelized version.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">download_and_store</span><span class="p">(</span><span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">downloader_function</span><span class="p">,</span> <span class="n">filename_function</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_function</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;skipping: &quot;</span><span class="p">,</span> <span class="n">ticker</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;loading: &quot;</span><span class="p">,</span> <span class="n">ticker</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">downloader_function</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="mi">2010</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failed: &quot;</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="s2">&quot; - &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;too short: &quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot; - &quot;</span><span class="p">,</span> <span class="n">ticker</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="functions-to-download-using-yahoo_historical-package">functions to download using yahoo_historical package<a class="anchor-link" href="#functions-to-download-using-yahoo_historical-package"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">downloadTicker_yahoo_historical</span><span class="p">(</span><span class="n">stock</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">startyear</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Download data using yahoo_historical Fetcher class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stockFetcher</span> <span class="o">=</span> <span class="n">Fetcher</span><span class="p">(</span><span class="n">stock</span><span class="p">,[</span><span class="n">startyear</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2020</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
    <span class="n">stock_df</span> <span class="o">=</span> <span class="n">stockFetcher</span><span class="o">.</span><span class="n">get_historical</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">stock_df</span>

<span class="k">def</span> <span class="nf">get_filename_yahoo_financials</span><span class="p">(</span><span class="n">ticker</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">stock_data_folder</span> <span class="o">+</span> <span class="n">ticker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">ticker</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>

<span class="k">def</span> <span class="nf">serial_download_using_yahoo_financials</span><span class="p">(</span><span class="n">tickers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
        <span class="n">download_and_store</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">downloadTicker_yahoo_historical</span><span class="p">,</span> <span class="n">get_filename_yahoo_financials</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="functions-to-download-using-yfinance-package">functions to download using yfinance package<a class="anchor-link" href="#functions-to-download-using-yfinance-package"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">downloadTicker_yfinance</span><span class="p">(</span><span class="n">stock</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">startyear</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Download data using yfinance package.</span>
<span class="sd">        it provides the major advantage, that the HOLC can be directly &quot;adjusted&quot;, meaning they are adapted for splits and dividends.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stock_df</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">startyear</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-01-01&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;2020-12-10&quot;</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auto_adjust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stock_df</span>

<span class="k">def</span> <span class="nf">get_filename_yfinance</span><span class="p">(</span><span class="n">ticker</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">stock_data_folder</span> <span class="o">+</span> <span class="n">ticker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">ticker</span> <span class="o">+</span> <span class="s2">&quot;_2.csv&quot;</span>

<span class="k">def</span> <span class="nf">serial_download_using_yfinance</span><span class="p">(</span><span class="n">tickers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
        <span class="n">download_and_store</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">downloadTicker_yfinance</span><span class="p">,</span> <span class="n">get_filename_yfinance</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="function-to-check-how-many-historical-data-could-be-downloaded">function to check how many historical data could be downloaded<a class="anchor-link" href="#function-to-check-how-many-historical-data-could-be-downloaded"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">count_and_return_missing</span><span class="p">(</span><span class="n">tickers</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">filename_function</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">missing</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counter_na</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">counter_ready</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename_function</span><span class="p">(</span><span class="n">ticker</span><span class="p">))</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">counter_na</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counter_ready</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;count of missing:    &quot;</span><span class="p">,</span> <span class="n">counter_na</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;count of downloaded: &quot;</span><span class="p">,</span> <span class="n">counter_ready</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">missing</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="download-using-yahoo_historicals-package">download using yahoo_historicals package<a class="anchor-link" href="#download-using-yahoo_historicals-package"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">serial_download_using_yahoo_financials</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span>
<span class="n">count_and_return_missing</span><span class="p">(</span><span class="n">tickers</span><span class="p">,</span> <span class="n">get_filename_yahoo_financials</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="download-using-yfinance-package">download using yfinance package<a class="anchor-link" href="#download-using-yfinance-package"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">serial_download_using_yfinance</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span>
<span class="n">count_and_return_missing</span><span class="p">(</span><span class="n">tickers</span><span class="p">,</span> <span class="n">get_filename_yfinance</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="04_Download-Additional-Data">04_Download Additional Data<a class="anchor-link" href="#04_Download-Additional-Data"> </a></h2><p>There are some important information which are not available from the SEC data. These are mainly the sector, industry the company is in, as well as the marketCap and the sharesOutstanding. These attributes are downloaded into a separate file.</p>
<p>The code in a Jupyter Notebook cannot be parallelized that easily, therefore there is the "08_Download_StodkData.py" Script that implements a parallelized version.</p>
<p>The data is downloaded from Yahoo Finance. However, Yahoo Finance restricts the number of calls that can be made from one computer within a certain amount of time. If there are too many requests from the same computer, yahoo answers with a HTTP Error 404.  Therefore the code has to be able to be started multiple times and has to keep track of the data that already has been downloaded successfully.</p>
<p>In the script "08_Download_StockData.py" there is a also a parallelized version of the code</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_add_data</span><span class="p">(</span><span class="n">ticker</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get some additional info using yfinance libary.</span>
<span class="sd">    if too many requests are made during a certain time, yahoo finance will block and start to answer with a 404.</span>
<span class="sd">    so it is necessary to keep track of the sucessfully or missing entries</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ticker&#39;</span>            <span class="p">:</span> <span class="n">ticker</span><span class="p">,</span>
                <span class="s1">&#39;sector&#39;</span>            <span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">],</span>
                <span class="s1">&#39;industry&#39;</span>          <span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;industry&#39;</span><span class="p">],</span>
                <span class="s1">&#39;marketCap&#39;</span>         <span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;marketCap&#39;</span><span class="p">],</span>
                <span class="s1">&#39;sharesOutstanding&#39;</span> <span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sharesOutstanding&#39;</span><span class="p">],</span>
                <span class="s1">&#39;message&#39;</span>           <span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
    
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;404&quot;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># ticker information was not found on yahoo, very likely because the company is not listed anymore</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ticker&#39;</span>            <span class="p">:</span> <span class="n">ticker</span><span class="p">,</span>
                <span class="s1">&#39;sector&#39;</span>            <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;industry&#39;</span>          <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;marketCap&#39;</span>         <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;sharesOutstanding&#39;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span>           <span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">download_add_info</span><span class="p">(</span><span class="n">tickers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot; serial version of downloading the additional information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="c1"># read the old data</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">stock_data_folder</span> <span class="o">+</span> <span class="s2">&quot;add_ticker_info.csv&quot;</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># figure out, which ticker information hasn&#39;t been downloaded already</span>
    <span class="n">current_tickers</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">tickers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tickers</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">current_tickers</span><span class="p">))</span>
    
    <span class="c1"># create now</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">,</span> <span class="s1">&#39;sector&#39;</span><span class="p">,</span> <span class="s1">&#39;industry&#39;</span><span class="p">,</span><span class="s1">&#39;marketCap&#39;</span><span class="p">,</span> <span class="s1">&#39;sharesOutstanding&#39;</span><span class="p">,</span><span class="s1">&#39;message&#39;</span><span class="p">],)</span>

    <span class="n">list_infos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
        <span class="n">list_infos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_add_data</span><span class="p">(</span><span class="n">ticker</span><span class="p">))</span>

    <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_infos</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new entries: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">current</span><span class="p">,</span> <span class="n">data</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;duration: &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

    <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">stock_data_folder</span> <span class="o">+</span> <span class="s2">&quot;add_ticker_info.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">download_add_info</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="05_Normalization-and-feature-generation-of-historical-data">05_Normalization and feature generation of historical data<a class="anchor-link" href="#05_Normalization-and-feature-generation-of-historical-data"> </a></h2><p>In order to be able to compare the historical stock price data of different companies, they have to be normalized.</p>
<ul>
<li>First, Open, High, and Low are compared with the Close price.</li>
<li>Second, the Close price is normalized (divided by) the last Close Price</li>
<li>Third, the volume is normalized by that sharesOutstanding </li>
</ul>
<p>Furthermore, as additional features, well we add</p>
<ul>
<li>the percentual change of the close Price, compared to the day before</li>
<li>the percentual change of the traded volume, compared to the day before</li>
<li>day of week, day of month, day of year, and month of year</li>
</ul>
<p>And again, there is also a parallelized version of this code in "08_Download_StockData.py"</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="reading-the-data">reading the data<a class="anchor-link" href="#reading-the-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># reading all files with adjusted OHLC Data (stored stored in &quot;*_2.csv&quot; files)</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="k">def</span> <span class="nf">get_data_files</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">stock_data_folder</span> <span class="o">+</span> <span class="s2">&quot;**/*_2.csv&quot;</span><span class="p">,</span><span class="n">recursive</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">read_stockdata</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">Date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">read_additional_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">stock_data_folder</span> <span class="o">+</span> <span class="s2">&quot;add_ticker_info.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_ticker_from_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">filename</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">stock_data_folder</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="o">-</span><span class="mi">6</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="normalization">normalization<a class="anchor-link" href="#normalization"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">norm_historical_data</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">shares_outstanding</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="n">lastClose</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;close_norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Close</span> <span class="o">/</span> <span class="n">lastClose</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_norm&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">High</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">Close</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;low_norm&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Low</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">Close</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;open_norm&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Open</span> <span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">Close</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Volume&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;volume_norm&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Volume</span> <span class="o">/</span> <span class="n">shares_outstanding</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="additional-features">additional features<a class="anchor-link" href="#additional-features"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">create_features_from_historical_data</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;close_chg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="n">close_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">close_change</span> <span class="o">=</span> <span class="p">((</span><span class="n">close_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">close_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">close_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>    
    
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="s1">&#39;close_chg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">close_change</span>
        
        
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;volume_chg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="n">volume_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Volume</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">volume_change</span> <span class="o">=</span> <span class="p">((</span><span class="n">volume_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">volume_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">volume_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>    
    
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="s1">&#39;volume_chg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume_change</span>
        
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span> <span class="o">/</span> <span class="mi">7</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_month&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="o">/</span> <span class="mi">31</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_year&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">/</span> <span class="mi">365</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;week_of_year&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekofyear</span> <span class="o">/</span> <span class="mi">52</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month_of_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">/</span> <span class="mi">12</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="process-stocks">process stocks<a class="anchor-link" href="#process-stocks"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">process_stock_data</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">df_add_info</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="n">ticker</span> <span class="o">=</span> <span class="n">get_ticker_from_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">df_stock</span> <span class="o">=</span> <span class="n">read_stockdata</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">df_stock_add_info</span> <span class="o">=</span> <span class="n">df_add_info</span><span class="p">[</span><span class="n">df_add_info</span><span class="o">.</span><span class="n">ticker</span> <span class="o">==</span> <span class="n">ticker</span><span class="p">]</span>
    
    <span class="n">sharesOutstanding</span> <span class="o">=</span> <span class="n">df_stock_add_info</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">sharesOutstanding</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">norm_historical_data</span><span class="p">(</span><span class="n">df_stock</span><span class="p">,</span> <span class="n">sharesOutstanding</span><span class="p">)</span>
    <span class="n">create_features_from_historical_data</span><span class="p">(</span><span class="n">df_stock</span><span class="p">)</span>
    
    <span class="n">df_stock</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">stock_data_folder</span> <span class="o">+</span> <span class="n">ticker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">ticker</span> <span class="o">+</span> <span class="s2">&quot;_processed.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">process_stock_data</span><span class="p">(</span><span class="n">stock_data_folder</span> <span class="o">+</span> <span class="s2">&quot;A/AAPL_2.csv&quot;</span><span class="p">,</span> <span class="n">df_add_info</span><span class="p">)</span> <span class="c1"># test with one stock</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_add_info</span> <span class="o">=</span> <span class="n">read_additional_info</span><span class="p">()</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">get_data_files</span><span class="p">()</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">pass</span>
    <span class="c1"># process_stock_data(filename, df_add_info)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="XX_Trials">XX_Trials<a class="anchor-link" href="#XX_Trials"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tickers</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;A&#39;, &#39;AA&#39;, &#39;AAC&#39;, ..., &#39;ZTM&#39;, &#39;ZTS&#39;, &#39;ZUMZ&#39;], dtype=object)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cik_tick_df</span> <span class="o">=</span> <span class="n">load_cik_ticker</span><span class="p">()</span>
<span class="n">cik_tick_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;CIK&#39;, &#39;Ticker&#39;, &#39;Name&#39;, &#39;Exchange&#39;, &#39;SIC&#39;, &#39;Business&#39;, &#39;Incorporated&#39;,
       &#39;IRS&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cik_tick_df</span><span class="p">[</span><span class="n">cik_tick_df</span><span class="o">.</span><span class="n">Ticker</span> <span class="o">==</span> <span class="s1">&#39;CNAT&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CIK</th>
      <th>Ticker</th>
      <th>Name</th>
      <th>Exchange</th>
      <th>SIC</th>
      <th>Business</th>
      <th>Incorporated</th>
      <th>IRS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2685</th>
      <td>1383701</td>
      <td>CNAT</td>
      <td>Conatus Pharmaceuticals Inc</td>
      <td>NASDAQ</td>
      <td>2834.0</td>
      <td>CA</td>
      <td>DE</td>
      <td>203183915.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stockFetcher</span> <span class="o">=</span> <span class="n">Fetcher</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,[</span><span class="mi">2010</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">stock_df</span> <span class="o">=</span> <span class="n">stockFetcher</span><span class="o">.</span><span class="n">get_historical</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stock_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2756, 7)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stock_df</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2010-01-04</td>
      <td>26.000362</td>
      <td>26.177889</td>
      <td>25.870815</td>
      <td>26.129908</td>
      <td>20.155407</td>
      <td>10829000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2010-01-05</td>
      <td>26.134706</td>
      <td>26.134706</td>
      <td>25.789249</td>
      <td>25.918797</td>
      <td>19.992567</td>
      <td>10562100</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2010-01-06</td>
      <td>25.880411</td>
      <td>26.096321</td>
      <td>25.837231</td>
      <td>26.062737</td>
      <td>20.103596</td>
      <td>11401400</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2010-01-07</td>
      <td>26.057938</td>
      <td>26.283443</td>
      <td>25.942785</td>
      <td>26.278646</td>
      <td>20.270136</td>
      <td>12857200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2010-01-08</td>
      <td>26.273848</td>
      <td>26.508949</td>
      <td>26.235464</td>
      <td>26.412991</td>
      <td>20.373764</td>
      <td>12148600</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2010-01-11</td>
      <td>26.532940</td>
      <td>26.619305</td>
      <td>26.422586</td>
      <td>26.547335</td>
      <td>20.477396</td>
      <td>10947200</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2010-01-12</td>
      <td>26.484961</td>
      <td>26.652889</td>
      <td>26.403395</td>
      <td>26.470566</td>
      <td>20.418177</td>
      <td>10939300</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2010-01-13</td>
      <td>26.321829</td>
      <td>26.648092</td>
      <td>26.317030</td>
      <td>26.528143</td>
      <td>20.612034</td>
      <td>10538900</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2010-01-14</td>
      <td>26.494556</td>
      <td>26.686476</td>
      <td>26.389000</td>
      <td>26.556931</td>
      <td>20.634401</td>
      <td>8982400</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2010-01-15</td>
      <td>26.561728</td>
      <td>26.662485</td>
      <td>26.465769</td>
      <td>26.624102</td>
      <td>20.686594</td>
      <td>16132500</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://aroussi.com/post/python-yahoo-finance">https://aroussi.com/post/python-yahoo-finance</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">yfinance</span> <span class="k">as</span> <span class="nn">yf</span>
<span class="n">msft</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">msft</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;zip&#39;: &#39;95014&#39;, &#39;sector&#39;: &#39;Technology&#39;, &#39;fullTimeEmployees&#39;: 147000, &#39;longBusinessSummary&#39;: &#39;Apple Inc. designs, manufactures, and markets smartphones, personal computers, tablets, wearables, and accessories worldwide. It also sells various related services. The company offers iPhone, a line of smartphones; Mac, a line of personal computers; iPad, a line of multi-purpose tablets; and wearables, home, and accessories comprising AirPods, Apple TV, Apple Watch, Beats products, HomePod, iPod touch, and other Apple-branded and third-party accessories. It also provides AppleCare support services; cloud services store services; and operates various platforms, including the App Store, that allow customers to discover and download applications and digital content, such as books, music, video, games, and podcasts. In addition, the company offers various services, such as Apple Arcade, a game subscription service; Apple Music, which offers users a curated listening experience with on-demand radio stations; Apple News+, a subscription news and magazine service; Apple TV+, which offers exclusive original content; Apple Card, a co-branded credit card; and Apple Pay, a cashless payment service, as well as licenses its intellectual property. The company serves consumers, and small and mid-sized businesses; and the education, enterprise, and government markets. It sells and delivers third-party applications for its products through the App Store. The company also sells its products through its retail and online stores, and direct sales force; and third-party cellular network carriers, wholesalers, retailers, and resellers. Apple Inc. was founded in 1977 and is headquartered in Cupertino, California.&#39;, &#39;city&#39;: &#39;Cupertino&#39;, &#39;phone&#39;: &#39;408-996-1010&#39;, &#39;state&#39;: &#39;CA&#39;, &#39;country&#39;: &#39;United States&#39;, &#39;companyOfficers&#39;: [], &#39;website&#39;: &#39;http://www.apple.com&#39;, &#39;maxAge&#39;: 1, &#39;address1&#39;: &#39;One Apple Park Way&#39;, &#39;industry&#39;: &#39;Consumer Electronics&#39;, &#39;previousClose&#39;: 127.88, &#39;regularMarketOpen&#39;: 127.41, &#39;twoHundredDayAverage&#39;: 109.04962, &#39;trailingAnnualDividendYield&#39;: 0.006216766, &#39;payoutRatio&#39;: 0.24239999, &#39;volume24Hr&#39;: None, &#39;regularMarketDayHigh&#39;: 128.36, &#39;navPrice&#39;: None, &#39;averageDailyVolume10Day&#39;: 98387850, &#39;totalAssets&#39;: None, &#39;regularMarketPreviousClose&#39;: 127.88, &#39;fiftyDayAverage&#39;: 118.74057, &#39;trailingAnnualDividendRate&#39;: 0.795, &#39;open&#39;: 127.41, &#39;toCurrency&#39;: None, &#39;averageVolume10days&#39;: 98387850, &#39;expireDate&#39;: None, &#39;yield&#39;: None, &#39;algorithm&#39;: None, &#39;dividendRate&#39;: 0.82, &#39;exDividendDate&#39;: 1604620800, &#39;beta&#39;: 1.297637, &#39;circulatingSupply&#39;: None, &#39;startDate&#39;: None, &#39;regularMarketDayLow&#39;: 126.56, &#39;priceHint&#39;: 2, &#39;currency&#39;: &#39;USD&#39;, &#39;trailingPE&#39;: 38.96646, &#39;regularMarketVolume&#39;: 98208591, &#39;lastMarket&#39;: None, &#39;maxSupply&#39;: None, &#39;openInterest&#39;: None, &#39;marketCap&#39;: 2172999958528, &#39;volumeAllCurrencies&#39;: None, &#39;strikePrice&#39;: None, &#39;averageVolume&#39;: 122994596, &#39;priceToSalesTrailing12Months&#39;: 7.9157786, &#39;dayLow&#39;: 126.56, &#39;ask&#39;: 0, &#39;ytdReturn&#39;: None, &#39;askSize&#39;: 900, &#39;volume&#39;: 98208591, &#39;fiftyTwoWeekHigh&#39;: 137.98, &#39;forwardPE&#39;: 29.449306, &#39;fromCurrency&#39;: None, &#39;fiveYearAvgDividendYield&#39;: 1.49, &#39;fiftyTwoWeekLow&#39;: 53.1525, &#39;bid&#39;: 0, &#39;tradeable&#39;: False, &#39;dividendYield&#39;: 0.0064, &#39;bidSize&#39;: 1300, &#39;dayHigh&#39;: 128.36, &#39;exchange&#39;: &#39;NMS&#39;, &#39;shortName&#39;: &#39;Apple Inc.&#39;, &#39;longName&#39;: &#39;Apple Inc.&#39;, &#39;exchangeTimezoneName&#39;: &#39;America/New_York&#39;, &#39;exchangeTimezoneShortName&#39;: &#39;EST&#39;, &#39;isEsgPopulated&#39;: False, &#39;gmtOffSetMilliseconds&#39;: &#39;-18000000&#39;, &#39;quoteType&#39;: &#39;EQUITY&#39;, &#39;symbol&#39;: &#39;AAPL&#39;, &#39;messageBoardId&#39;: &#39;finmb_24937&#39;, &#39;market&#39;: &#39;us_market&#39;, &#39;annualHoldingsTurnover&#39;: None, &#39;enterpriseToRevenue&#39;: 8.034, &#39;beta3Year&#39;: None, &#39;profitMargins&#39;: 0.20914, &#39;enterpriseToEbitda&#39;: 28.516, &#39;52WeekChange&#39;: 0.82572675, &#39;morningStarRiskRating&#39;: None, &#39;forwardEps&#39;: 4.34, &#39;revenueQuarterlyGrowth&#39;: None, &#39;sharesOutstanding&#39;: 17102499840, &#39;fundInceptionDate&#39;: None, &#39;annualReportExpenseRatio&#39;: None, &#39;bookValue&#39;: 3.849, &#39;sharesShort&#39;: 89985311, &#39;sharesPercentSharesOut&#39;: 0.0053, &#39;fundFamily&#39;: None, &#39;lastFiscalYearEnd&#39;: 1601078400, &#39;heldPercentInstitutions&#39;: 0.59707, &#39;netIncomeToCommon&#39;: 57410998272, &#39;trailingEps&#39;: 3.28, &#39;lastDividendValue&#39;: 0.205, &#39;SandP52WeekChange&#39;: 0.15467787, &#39;priceToBook&#39;: 33.206028, &#39;heldPercentInsiders&#39;: 0.00066, &#39;nextFiscalYearEnd&#39;: 1664150400, &#39;mostRecentQuarter&#39;: 1601078400, &#39;shortRatio&#39;: 0.82, &#39;sharesShortPreviousMonthDate&#39;: 1604016000, &#39;floatShares&#39;: 16984630180, &#39;enterpriseValue&#39;: 2205525475328, &#39;threeYearAverageReturn&#39;: None, &#39;lastSplitDate&#39;: 1598832000, &#39;lastSplitFactor&#39;: &#39;4:1&#39;, &#39;legalType&#39;: None, &#39;lastDividendDate&#39;: 1604620800, &#39;morningStarOverallRating&#39;: None, &#39;earningsQuarterlyGrowth&#39;: -0.074, &#39;dateShortInterest&#39;: 1606694400, &#39;pegRatio&#39;: 2.55, &#39;lastCapGain&#39;: None, &#39;shortPercentOfFloat&#39;: 0.0053, &#39;sharesShortPriorMonth&#39;: 80528396, &#39;impliedSharesOutstanding&#39;: None, &#39;category&#39;: None, &#39;fiveYearAverageReturn&#39;: None, &#39;regularMarketPrice&#39;: 127.41, &#39;logo_url&#39;: &#39;https://logo.clearbit.com/apple.com&#39;}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">msft</span><span class="o">.</span><span class="n">get_balance_sheet</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">msft</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">msft</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;industry&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">msft</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;marketCap&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">msft</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;sharesOutstanding&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Technology
SoftwareInfrastructure
1612352192512
7560500224
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;SPY AAPL&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2017-01-01&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2017-04-30&quot;</span><span class="p">,</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[*********************100%***********************]  2 of 2 completed
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Adj Close</th>
      <th colspan="2" halign="left">Close</th>
      <th colspan="2" halign="left">High</th>
      <th colspan="2" halign="left">Low</th>
      <th colspan="2" halign="left">Open</th>
      <th colspan="2" halign="left">Volume</th>
    </tr>
    <tr>
      <th></th>
      <th>AAPL</th>
      <th>SPY</th>
      <th>AAPL</th>
      <th>SPY</th>
      <th>AAPL</th>
      <th>SPY</th>
      <th>AAPL</th>
      <th>SPY</th>
      <th>AAPL</th>
      <th>SPY</th>
      <th>AAPL</th>
      <th>SPY</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-01-03</th>
      <td>27.277639</td>
      <td>209.785889</td>
      <td>29.037500</td>
      <td>225.240005</td>
      <td>29.082500</td>
      <td>225.830002</td>
      <td>28.690001</td>
      <td>223.880005</td>
      <td>28.950001</td>
      <td>225.039993</td>
      <td>115127600</td>
      <td>91366500</td>
    </tr>
    <tr>
      <th>2017-01-04</th>
      <td>27.247108</td>
      <td>211.033981</td>
      <td>29.004999</td>
      <td>226.580002</td>
      <td>29.127501</td>
      <td>226.750000</td>
      <td>28.937500</td>
      <td>225.610001</td>
      <td>28.962500</td>
      <td>225.619995</td>
      <td>84472400</td>
      <td>78744400</td>
    </tr>
    <tr>
      <th>2017-01-05</th>
      <td>27.385668</td>
      <td>210.866318</td>
      <td>29.152500</td>
      <td>226.399994</td>
      <td>29.215000</td>
      <td>226.580002</td>
      <td>28.952499</td>
      <td>225.479996</td>
      <td>28.980000</td>
      <td>226.270004</td>
      <td>88774400</td>
      <td>78379000</td>
    </tr>
    <tr>
      <th>2017-01-06</th>
      <td>27.690971</td>
      <td>211.620728</td>
      <td>29.477501</td>
      <td>227.210007</td>
      <td>29.540001</td>
      <td>227.750000</td>
      <td>29.117500</td>
      <td>225.899994</td>
      <td>29.195000</td>
      <td>226.529999</td>
      <td>127007600</td>
      <td>71559900</td>
    </tr>
    <tr>
      <th>2017-01-09</th>
      <td>27.944603</td>
      <td>210.922211</td>
      <td>29.747499</td>
      <td>226.460007</td>
      <td>29.857500</td>
      <td>227.070007</td>
      <td>29.485001</td>
      <td>226.419998</td>
      <td>29.487499</td>
      <td>226.910004</td>
      <td>134247600</td>
      <td>46939700</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2017-04-24</th>
      <td>33.879871</td>
      <td>221.858353</td>
      <td>35.910000</td>
      <td>237.169998</td>
      <td>35.987499</td>
      <td>237.410004</td>
      <td>35.794998</td>
      <td>234.559998</td>
      <td>35.875000</td>
      <td>237.179993</td>
      <td>68537200</td>
      <td>119209900</td>
    </tr>
    <tr>
      <th>2017-04-25</th>
      <td>34.089794</td>
      <td>223.149246</td>
      <td>36.132500</td>
      <td>238.550003</td>
      <td>36.224998</td>
      <td>238.949997</td>
      <td>35.967499</td>
      <td>237.809998</td>
      <td>35.977501</td>
      <td>237.910004</td>
      <td>75486000</td>
      <td>76698300</td>
    </tr>
    <tr>
      <th>2017-04-26</th>
      <td>33.889301</td>
      <td>223.008942</td>
      <td>35.919998</td>
      <td>238.399994</td>
      <td>36.150002</td>
      <td>239.529999</td>
      <td>35.845001</td>
      <td>238.350006</td>
      <td>36.117500</td>
      <td>238.509995</td>
      <td>80164800</td>
      <td>84702500</td>
    </tr>
    <tr>
      <th>2017-04-27</th>
      <td>33.915257</td>
      <td>223.196014</td>
      <td>35.947498</td>
      <td>238.600006</td>
      <td>36.040001</td>
      <td>238.949997</td>
      <td>35.827499</td>
      <td>237.979996</td>
      <td>35.980000</td>
      <td>238.770004</td>
      <td>56985200</td>
      <td>57410300</td>
    </tr>
    <tr>
      <th>2017-04-28</th>
      <td>33.882225</td>
      <td>222.709595</td>
      <td>35.912498</td>
      <td>238.080002</td>
      <td>36.075001</td>
      <td>238.929993</td>
      <td>35.817501</td>
      <td>237.929993</td>
      <td>36.022499</td>
      <td>238.899994</td>
      <td>83441600</td>
      <td>63532800</td>
    </tr>
  </tbody>
</table>
<p>81 rows  12 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;AAC&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2010-01-01&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2020-12-11&quot;</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[*********************100%***********************]  1 of 1 completed

1 Failed download:
- AAC: No data found, symbol may be delisted
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Adj Close</th>
      <th>Volume</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">aacob</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="s2">&quot;AAPL&quot;</span><span class="p">)</span>
<span class="n">aacob</span><span class="o">.</span><span class="n">info</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;zip&#39;: &#39;95014&#39;,
 &#39;sector&#39;: &#39;Technology&#39;,
 &#39;fullTimeEmployees&#39;: 147000,
 &#39;longBusinessSummary&#39;: &#39;Apple Inc. designs, manufactures, and markets smartphones, personal computers, tablets, wearables, and accessories worldwide. It also sells various related services. The company offers iPhone, a line of smartphones; Mac, a line of personal computers; iPad, a line of multi-purpose tablets; and wearables, home, and accessories comprising AirPods, Apple TV, Apple Watch, Beats products, HomePod, iPod touch, and other Apple-branded and third-party accessories. It also provides AppleCare support services; cloud services store services; and operates various platforms, including the App Store, that allow customers to discover and download applications and digital content, such as books, music, video, games, and podcasts. In addition, the company offers various services, such as Apple Arcade, a game subscription service; Apple Music, which offers users a curated listening experience with on-demand radio stations; Apple News+, a subscription news and magazine service; Apple TV+, which offers exclusive original content; Apple Card, a co-branded credit card; and Apple Pay, a cashless payment service, as well as licenses its intellectual property. The company serves consumers, and small and mid-sized businesses; and the education, enterprise, and government markets. It sells and delivers third-party applications for its products through the App Store. The company also sells its products through its retail and online stores, and direct sales force; and third-party cellular network carriers, wholesalers, retailers, and resellers. Apple Inc. was founded in 1977 and is headquartered in Cupertino, California.&#39;,
 &#39;city&#39;: &#39;Cupertino&#39;,
 &#39;phone&#39;: &#39;408-996-1010&#39;,
 &#39;state&#39;: &#39;CA&#39;,
 &#39;country&#39;: &#39;United States&#39;,
 &#39;companyOfficers&#39;: [],
 &#39;website&#39;: &#39;http://www.apple.com&#39;,
 &#39;maxAge&#39;: 1,
 &#39;address1&#39;: &#39;One Apple Park Way&#39;,
 &#39;industry&#39;: &#39;Consumer Electronics&#39;,
 &#39;previousClose&#39;: 127.88,
 &#39;regularMarketOpen&#39;: 127.41,
 &#39;twoHundredDayAverage&#39;: 109.04962,
 &#39;trailingAnnualDividendYield&#39;: 0.006216766,
 &#39;payoutRatio&#39;: 0.24239999,
 &#39;volume24Hr&#39;: None,
 &#39;regularMarketDayHigh&#39;: 128.36,
 &#39;navPrice&#39;: None,
 &#39;averageDailyVolume10Day&#39;: 98387850,
 &#39;totalAssets&#39;: None,
 &#39;regularMarketPreviousClose&#39;: 127.88,
 &#39;fiftyDayAverage&#39;: 118.74057,
 &#39;trailingAnnualDividendRate&#39;: 0.795,
 &#39;open&#39;: 127.41,
 &#39;toCurrency&#39;: None,
 &#39;averageVolume10days&#39;: 98387850,
 &#39;expireDate&#39;: None,
 &#39;yield&#39;: None,
 &#39;algorithm&#39;: None,
 &#39;dividendRate&#39;: 0.82,
 &#39;exDividendDate&#39;: 1604620800,
 &#39;beta&#39;: 1.297637,
 &#39;circulatingSupply&#39;: None,
 &#39;startDate&#39;: None,
 &#39;regularMarketDayLow&#39;: 126.56,
 &#39;priceHint&#39;: 2,
 &#39;currency&#39;: &#39;USD&#39;,
 &#39;trailingPE&#39;: 38.96646,
 &#39;regularMarketVolume&#39;: 98208591,
 &#39;lastMarket&#39;: None,
 &#39;maxSupply&#39;: None,
 &#39;openInterest&#39;: None,
 &#39;marketCap&#39;: 2172999958528,
 &#39;volumeAllCurrencies&#39;: None,
 &#39;strikePrice&#39;: None,
 &#39;averageVolume&#39;: 122994596,
 &#39;priceToSalesTrailing12Months&#39;: 7.9157786,
 &#39;dayLow&#39;: 126.56,
 &#39;ask&#39;: 0,
 &#39;ytdReturn&#39;: None,
 &#39;askSize&#39;: 900,
 &#39;volume&#39;: 98208591,
 &#39;fiftyTwoWeekHigh&#39;: 137.98,
 &#39;forwardPE&#39;: 29.449306,
 &#39;fromCurrency&#39;: None,
 &#39;fiveYearAvgDividendYield&#39;: 1.49,
 &#39;fiftyTwoWeekLow&#39;: 53.1525,
 &#39;bid&#39;: 0,
 &#39;tradeable&#39;: False,
 &#39;dividendYield&#39;: 0.0064,
 &#39;bidSize&#39;: 1300,
 &#39;dayHigh&#39;: 128.36,
 &#39;exchange&#39;: &#39;NMS&#39;,
 &#39;shortName&#39;: &#39;Apple Inc.&#39;,
 &#39;longName&#39;: &#39;Apple Inc.&#39;,
 &#39;exchangeTimezoneName&#39;: &#39;America/New_York&#39;,
 &#39;exchangeTimezoneShortName&#39;: &#39;EST&#39;,
 &#39;isEsgPopulated&#39;: False,
 &#39;gmtOffSetMilliseconds&#39;: &#39;-18000000&#39;,
 &#39;quoteType&#39;: &#39;EQUITY&#39;,
 &#39;symbol&#39;: &#39;AAPL&#39;,
 &#39;messageBoardId&#39;: &#39;finmb_24937&#39;,
 &#39;market&#39;: &#39;us_market&#39;,
 &#39;annualHoldingsTurnover&#39;: None,
 &#39;enterpriseToRevenue&#39;: 8.034,
 &#39;beta3Year&#39;: None,
 &#39;profitMargins&#39;: 0.20914,
 &#39;enterpriseToEbitda&#39;: 28.516,
 &#39;52WeekChange&#39;: 0.82572675,
 &#39;morningStarRiskRating&#39;: None,
 &#39;forwardEps&#39;: 4.34,
 &#39;revenueQuarterlyGrowth&#39;: None,
 &#39;sharesOutstanding&#39;: 17102499840,
 &#39;fundInceptionDate&#39;: None,
 &#39;annualReportExpenseRatio&#39;: None,
 &#39;bookValue&#39;: 3.849,
 &#39;sharesShort&#39;: 89985311,
 &#39;sharesPercentSharesOut&#39;: 0.0053,
 &#39;fundFamily&#39;: None,
 &#39;lastFiscalYearEnd&#39;: 1601078400,
 &#39;heldPercentInstitutions&#39;: 0.59707,
 &#39;netIncomeToCommon&#39;: 57410998272,
 &#39;trailingEps&#39;: 3.28,
 &#39;lastDividendValue&#39;: 0.205,
 &#39;SandP52WeekChange&#39;: 0.15467787,
 &#39;priceToBook&#39;: 33.206028,
 &#39;heldPercentInsiders&#39;: 0.00066,
 &#39;nextFiscalYearEnd&#39;: 1664150400,
 &#39;mostRecentQuarter&#39;: 1601078400,
 &#39;shortRatio&#39;: 0.82,
 &#39;sharesShortPreviousMonthDate&#39;: 1604016000,
 &#39;floatShares&#39;: 16984630180,
 &#39;enterpriseValue&#39;: 2205525475328,
 &#39;threeYearAverageReturn&#39;: None,
 &#39;lastSplitDate&#39;: 1598832000,
 &#39;lastSplitFactor&#39;: &#39;4:1&#39;,
 &#39;legalType&#39;: None,
 &#39;lastDividendDate&#39;: 1604620800,
 &#39;morningStarOverallRating&#39;: None,
 &#39;earningsQuarterlyGrowth&#39;: -0.074,
 &#39;dateShortInterest&#39;: 1606694400,
 &#39;pegRatio&#39;: 2.55,
 &#39;lastCapGain&#39;: None,
 &#39;shortPercentOfFloat&#39;: 0.0053,
 &#39;sharesShortPriorMonth&#39;: 80528396,
 &#39;impliedSharesOutstanding&#39;: None,
 &#39;category&#39;: None,
 &#39;fiveYearAverageReturn&#39;: None,
 &#39;regularMarketPrice&#39;: 127.41,
 &#39;logo_url&#39;: &#39;https://logo.clearbit.com/apple.com&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>quotes for delisted companies</p>
<p><a href="https://www.quantshare.com/item-81-historical-quotes-for-delisted-us-stocks">https://www.quantshare.com/item-81-historical-quotes-for-delisted-us-stocks</a>
<a href="https://money.stackexchange.com/questions/18723/how-to-find-historical-stock-price-for-a-de-listed-or-defunct-company">https://money.stackexchange.com/questions/18723/how-to-find-historical-stock-price-for-a-de-listed-or-defunct-company</a></p>

</div>
</div>
</div>
</div>
 

